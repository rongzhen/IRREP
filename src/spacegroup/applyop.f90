
! Copyright (C) 2002-2005 J. K. Dewhurst, S. Sharma and C. Ambrosch-Draxl.
! This file is distributed under the terms of the GNU General Public License.
! See the file COPYING for license details.

subroutine applyop(op,u,v)
implicit none
! arguments
character(25), intent(in) :: op
real(8), intent(in) :: u(3)
real(8), intent(out) :: v(3)
! local variables
integer p(2,3),i
real(8) x,y,z
character(25) str
x=u(1)
y=u(2)
z=u(3)
! find the operator positions in the string
p(1,1)=1
p(2,1)=index(op,',')-1
p(1,2)=index(op,',')+1
p(2,2)=index(op,',',back=.true.)-1
p(1,3)=index(op,',',back=.true.)+1
p(2,3)=len_trim(op)
do i=1,3
  str=op(p(1,i):p(2,i))
  select case(adjustl(str))
!-------------------------------------------------------------------------------
  case('X')
    v(i)=x
  case('Y')
    v(i)=y
  case('Z')
    v(i)=z
!-------------------------------------------------------------------------------
  case('-X')
    v(i)=-x
  case('-Y')
    v(i)=-y
  case('-Z')
    v(i)=-z
!-------------------------------------------------------------------------------
  case('X+1/2')
    v(i)=x+0.5d0
  case('Y+1/2')
    v(i)=y+0.5d0
  case('Z+1/2')
    v(i)=z+0.5d0
!-------------------------------------------------------------------------------
  case('-X+1/2')
    v(i)=-x+0.5d0
  case('-Y+1/2')
    v(i)=-y+0.5d0
  case('-Z+1/2')
    v(i)=-z+0.5d0
!-------------------------------------------------------------------------------
  case('X+1/4')
    v(i)=x+0.25d0
  case('Y+1/4')
    v(i)=y+0.25d0
  case('Z+1/4')
    v(i)=z+0.25d0
!-------------------------------------------------------------------------------
  case('-X+1/4')
    v(i)=-x+0.25d0
  case('-Y+1/4')
    v(i)=-y+0.25d0
  case('-Z+1/4')
    v(i)=-z+0.25d0
!-------------------------------------------------------------------------------
  case('X+3/4')
    v(i)=x+0.75d0
  case('Y+3/4')
    v(i)=y+0.75d0
  case('Z+3/4')
    v(i)=z+0.75d0
!-------------------------------------------------------------------------------
  case('-X+3/4')
    v(i)=-x+0.75d0
  case('-Y+3/4')
    v(i)=-y+0.75d0
  case('-Z+3/4')
    v(i)=-z+0.75d0
!-------------------------------------------------------------------------------
  case('X-Y')
    v(i)=x-y
  case('Y-X')
    v(i)=y-x
!-------------------------------------------------------------------------------
  case('X+1/3')
    v(i)=x+1.d0/3.d0
  case('Y+1/3')
    v(i)=y+1.d0/3.d0
  case('Z+1/3')
    v(i)=z+1.d0/3.d0
!-------------------------------------------------------------------------------
  case('X+2/3')
    v(i)=x+2.d0/3.d0
  case('Y+2/3')
    v(i)=y+2.d0/3.d0
  case('Z+2/3')
    v(i)=z+2.d0/3.d0
!-------------------------------------------------------------------------------
  case('-X+2/3')
    v(i)=-x+2.d0/3.d0
  case('-Y+2/3')
    v(i)=-y+2.d0/3.d0
  case('-Z+2/3')
    v(i)=-z+2.d0/3.d0
!-------------------------------------------------------------------------------
  case('-X+1/3')
    v(i)=-x+1.d0/3.d0
  case('-Y+1/3')
    v(i)=-y+1.d0/3.d0
  case('-Z+1/3')
    v(i)=-z+1.d0/3.d0
!-------------------------------------------------------------------------------
  case('Z+5/6')
    v(i)=z+5.d0/6.d0
!-------------------------------------------------------------------------------
  case('Z+1/6')
    v(i)=z+1.d0/6.d0
!-------------------------------------------------------------------------------
  case('-Z+5/6')
    v(i)=-z+5.d0/6.d0
!-------------------------------------------------------------------------------
  case('-Z+1/6')
    v(i)=-z+1.d0/6.d0
!-------------------------------------------------------------------------------
  case default
    write(*,*)
    write(*,'("Error(applyop): could not parse string : ")')
    write(*,'(A25)') op
    write(*,*)
    stop
  end select
end do
return
end subroutine

